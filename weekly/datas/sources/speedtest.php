<span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><a name="l1" /></span><span style="color: #FF8000">/**<br /><a name="l2" />&nbsp;*&nbsp;This&nbsp;file&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;speedtest&nbsp;OrientDB-PHP&nbsp;library&nbsp;on&nbsp;creating,<br /><a name="l3" />&nbsp;*&nbsp;modifying&nbsp;and&nbsp;deleting&nbsp;records.<br /><a name="l4" />&nbsp;*&nbsp;Before&nbsp;use,&nbsp;you&nbsp;must&nbsp;create&nbsp;DB&nbsp;named&nbsp;'speedtest'&nbsp;manually.<br /><a name="l5" />&nbsp;*<br /><a name="l6" />&nbsp;*&nbsp;@author&nbsp;Anton&nbsp;Terekhov&nbsp;&lt;anton@netmonsters.ru&gt;<br /><a name="l7" />&nbsp;*&nbsp;@copyright&nbsp;Copyright&nbsp;Anton&nbsp;Terekhov,&nbsp;NetMonsters&nbsp;LLC,&nbsp;2011<br /><a name="l8" />&nbsp;*&nbsp;@license&nbsp;https://github.com/AntonTerekhov/OrientDB-PHP/blob/master/LICENSE<br /><a name="l9" />&nbsp;*&nbsp;@link&nbsp;https://github.com/AntonTerekhov/OrientDB-PHP<br /><a name="l10" />&nbsp;*&nbsp;@package&nbsp;OrientDB-PHP<br /><a name="l11" />&nbsp;*&nbsp;@subpackage&nbsp;Example<br /><a name="l12" />&nbsp;*/<br /><a name="l13" /><br /><a name="l14" /></span><span style="color: #007700">require&nbsp;</span><span style="color: #DD0000">'OrientDB/OrientDB.php'</span><span style="color: #007700">;<br /><a name="l15" /><br /><a name="l16" /></span><span style="color: #0000BB">$records&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">100000</span><span style="color: #007700">;<br /><a name="l17" /><br /><a name="l18" /></span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l19" />echo&nbsp;</span><span style="color: #DD0000">'Socket'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l20" /></span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">OrientDB</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2424</span><span style="color: #007700">);<br /><a name="l21" />echo&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l22" /><br /><a name="l23" /></span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l24" />echo&nbsp;</span><span style="color: #DD0000">'OpenDB&nbsp;DB'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l25" /></span><span style="color: #0000BB">$clusters&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">DBOpen</span><span style="color: #007700">(</span><span style="color: #DD0000">'speedtest'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'admin'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'admin'</span><span style="color: #007700">);<br /><a name="l26" />echo&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l27" /><br /><a name="l28" /></span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l29" /></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><a name="l30" />for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$records</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br /><a name="l31" />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l32" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$position&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">recordCreate</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Name:"Bill",Id:'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">);<br /><a name="l33" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$position</span><span style="color: #007700">;<br /><a name="l34" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l35" />&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(</span><span style="color: #0000BB">OrientDBException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br /><a name="l36" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l37" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l38" />}<br /><a name="l39" />echo&nbsp;</span><span style="color: #DD0000">'Done&nbsp;create&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$records&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l40" />echo&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l41" /><br /><a name="l42" /></span><span style="color: #0000BB">$callback&nbsp;</span><span style="color: #007700">=&nbsp;function&nbsp;(&amp;</span><span style="color: #0000BB">$item</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">)&nbsp;{<br /><a name="l43" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$item&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'#2:'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$item</span><span style="color: #007700">;<br /><a name="l44" />};<br /><a name="l45" /><br /><a name="l46" /></span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l47" /></span><span style="color: #0000BB">$linked_records&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><a name="l48" />for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$records&nbsp;</span><span style="color: #007700">/&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br /><a name="l49" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$rand_record&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">[</span><span style="color: #0000BB">array_rand</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">)];<br /><a name="l50" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$keys&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_rand</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$records&nbsp;</span><span style="color: #007700">/&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /><a name="l51" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$links&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><a name="l52" />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$keys&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">)&nbsp;{<br /><a name="l53" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$links</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">];<br /><a name="l54" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l55" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_walk</span><span style="color: #007700">(</span><span style="color: #0000BB">$links</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$callback</span><span style="color: #007700">);<br /><a name="l56" />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l57" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">recordUpdate</span><span style="color: #007700">(</span><span style="color: #DD0000">'2:'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$rand_record</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Name:"Bill",Id:'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">',&nbsp;map:['&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">','</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$links</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">']'</span><span style="color: #007700">);<br /><a name="l58" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$linked_records</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$rand_record</span><span style="color: #007700">;<br /><a name="l59" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l60" />&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(</span><span style="color: #0000BB">OrientDBException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br /><a name="l61" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l62" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l63" />}<br /><a name="l64" />echo&nbsp;</span><span style="color: #DD0000">'Done&nbsp;update&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$records&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l65" />echo&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l66" /><br /><a name="l67" /></span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l68" /></span><span style="color: #0000BB">$record&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">recordLoad</span><span style="color: #007700">(</span><span style="color: #DD0000">'2:'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">[</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'*:-1'</span><span style="color: #007700">);<br /><a name="l69" />echo&nbsp;</span><span style="color: #DD0000">'Done&nbsp;get&nbsp;last'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l70" />echo&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l71" /><br /><a name="l72" /></span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l73" /></span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDebug</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l74" />try&nbsp;{<br /><a name="l75" />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$record&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">recordLoad</span><span style="color: #007700">(</span><span style="color: #DD0000">'2:'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$linked_records</span><span style="color: #007700">[</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$linked_records</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">],&nbsp;</span><span style="color: #DD0000">'*:10'</span><span style="color: #007700">);<br /><a name="l76" />}<br /><a name="l77" />catch&nbsp;(</span><span style="color: #0000BB">OrientDBException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br /><a name="l78" />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l79" />}<br /><a name="l80" /></span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDebug</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br /><a name="l81" />echo&nbsp;</span><span style="color: #DD0000">'Done&nbsp;get&nbsp;linked'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l82" />echo&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l83" /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$record</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">content</span><span style="color: #007700">);<br /><a name="l84" /><br /><a name="l85" /></span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><a name="l86" />for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br /><a name="l87" />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br /><a name="l88" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">recordDelete</span><span style="color: #007700">(</span><span style="color: #DD0000">'2:'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]);<br /><a name="l89" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l90" />&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(</span><span style="color: #0000BB">OrientDBException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br /><a name="l91" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">()&nbsp;.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l92" />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><a name="l93" />}<br /><a name="l94" />echo&nbsp;</span><span style="color: #DD0000">'Done&nbsp;delete&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$records&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l95" />echo&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">$time_c&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><a name="l96" /><br /><a name="l97" /><br /><a name="l98" /><br /><a name="l99" /></span>
</span>